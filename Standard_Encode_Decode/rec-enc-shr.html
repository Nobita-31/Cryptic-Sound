<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* Deep Space Color Palette */
        :root {
          --void-black: #020207;
          --cosmic-dark: #0a0a15;
          --nebula-blue: #0066ff;
          --quasar-purple: #7d00ff;
          --pulsar-green: #00ffaa;
          --star-white: rgba(255, 255, 255, 0.9);
          --dust-glow: rgba(0, 102, 255, 0.15);
        }
  
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }
  
        body {
          min-height: 100vh;
          overflow: hidden;
          display: flex;
          justify-content: center;
          align-items: center;
          position: relative;
  
          background-color: #000;
        }
  
      
        /* Black Hole Console */
        .container {
          width: 95%;
          max-width: 600px;
          padding: 30px;
          background: rgba(10, 10, 21, 0.85);
          border: 1px solid var(--nebula-blue);
          border-radius: 8px;
          box-shadow: 0 0 30px rgba(0, 102, 255, 0.2),
            inset 0 0 30px rgba(0, 102, 255, 0.1);
          position: relative;
          z-index: 10;
          backdrop-filter: blur(8px);
          transform-origin: center;
          transform: perspective(1000px) rotateX(5deg)translateZ(0);
          animation: cosmicFloat 12s ease-in-out infinite;
          overflow: hidden;
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
        }
  
        /* Event Horizon Effect */
        .container::before {
          content: "";
          position: absolute;
          top: -5px;
          left: -5px;
          right: -5px;
          bottom: -5px;
          border-radius: 12px;
          background: linear-gradient(
            45deg,
            var(--quasar-purple),
            var(--nebula-blue),
            var(--pulsar-green)
          );
          z-index: -1;
          filter: blur(20px);
          opacity: 0.3;
          animation: cosmicPulse 8s linear infinite;
        }
  
        /* Title Styling */
        h1 {
          text-align: center;
          font-size: clamp(1.8rem, 6vw, 2.5rem);
          margin-bottom: 30px;
          letter-spacing: 4px;
          color: var(--pulsar-green);
          text-shadow: 0 0 8px var(--pulsar-green), 0 0 16px var(--pulsar-green);
          position: relative;
          font-weight: bold;
        }
  
        h1::after {
          content: "";
          position: absolute;
          bottom: -12px;
          left: 50%;
          transform: translateX(-50%);
          width: 150px;
          height: 2px;
          background: linear-gradient(
            90deg,
            transparent,
            var(--nebula-blue),
            var(--pulsar-green),
            transparent
          );
        }
  
        /* File Input Styling */
        .file-input-wrapper {
          margin-bottom: 30px;
          position: relative;
          width: 100%;
        }
  
        .file-input-label {
          display: block;
          width: 100%;
          padding: 16px;
          background: rgba(0, 0, 0, 0.4);
          border: 1px solid var(--nebula-blue);
          border-radius: 6px;
          text-align: center;
          font-size: clamp(0.9rem, 4vw, 1.1rem);
          color: var(--star-white);
          cursor: pointer;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
        }
  
        .file-input-label:hover {
          background: rgba(0, 0, 0, 0.6);
          border-color: var(--pulsar-green);
          box-shadow: 0 0 20px var(--dust-glow);
        }
  
        .file-input-label::before {
          content: "ðŸŒŒ";
          margin-right: 10px;
          filter: drop-shadow(0 0 4px var(--nebula-blue));
        }
  
        .file-input-label::after {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(0, 255, 170, 0.1),
            transparent
          );
          transition: 0.5s;
        }
  
        .file-input-label:hover::after {
          left: 100%;
        }
  
        #imageInput {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          border: 0;
        }
  
        /* Button Styling */
        .button-group {
          display: flex;
          flex-direction: column;
          gap: 20px;
          /* margin-bottom: 30px; */
        }
  
        button {
          padding: 16px;
          margin-bottom: 20px;
          background: linear-gradient(
            135deg,
            rgba(0, 102, 255, 0.3),
            rgba(125, 0, 255, 0.3)
          );
          border: 1px solid var(--nebula-blue);
          border-radius: 6px;
          color: var(--star-white);
          font-family: "Courier New", monospace;
          font-size: clamp(1rem, 4vw, 1.2rem);
          font-weight: bold;
          cursor: pointer;
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
          box-shadow: 0 0 15px rgba(0, 102, 255, 0.3),
            inset 0 0 10px rgba(0, 102, 255, 0.2);
          letter-spacing: 1px;
          text-transform: uppercase;
        }
  
        button:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          box-shadow: none;
          background: rgba(0, 0, 0, 0.3);
          border-color: rgba(0, 102, 255, 0.5);
        }
  
        button:not(:disabled):hover {
          transform: translateY(-3px);
          background: linear-gradient(
            135deg,
            rgba(0, 102, 255, 0.5),
            rgba(125, 0, 255, 0.5)
          );
          box-shadow: 0 0 25px rgba(0, 102, 255, 0.5),
            inset 0 0 15px rgba(0, 102, 255, 0.3);
        }
  
        button::before {
          content: "";
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg,
            transparent,
            rgba(0, 255, 170, 0.2),
            transparent
          );
          transition: 0.5s;
        }
  
        button:not(:disabled):hover::before {
          left: 100%;
        }
  
      
        @keyframes cosmicFloat {
          0%,
          100% {
            transform: perspective(1000px) rotateX(5deg) translateY(0) translateZ(0);
          }
          50% {
            transform: perspective(1000px) rotateX(5deg) translateY(-20px) translateZ(0);
          }
        }
  
        @keyframes cosmicPulse {
          0%,
          100% {
            opacity: 0.3;
          }
          50% {
            opacity: 0.5;
          }
        }
  
        /* Responsive Design */
        @media (max-width: 768px) {
          .container {
            padding: 25px;
          }
  
          h1 {
            font-size: clamp(1.5rem, 6vw, 2rem);
            margin-bottom: 25px;
          }
  
          .file-input-label,
          button {
            padding: 14px;
          }
  
          .button-group {
            gap: 15px;
            margin-bottom: 25px;
          }
        }
  
        @media (max-width: 480px) {
          .container {
            padding: 20px;
          }
  
          h1 {
            letter-spacing: 2px;
          }
  
          .file-input-label,
          button {
            padding: 12px;
            font-size: 0.95rem;
          }
        }


        .starfield {
              position: absolute;
              width: 100%;
              height: 100%;
              top: 0;
              left: 0;
              z-index: -1;
          }
  
          .star {
              position: absolute;
              background: white;
              border-radius: 100%;
              z-index: -1;
              box-shadow: 1px 1px 16px 1px white;
              animation: drift linear infinite;
          }
  
          @keyframes drift {
              0% {
                  transform: translate(var(--start-x), var(--start-y));
                  opacity: 0;
              }
              10%, 90% {
                  opacity: var(--opacity);
              }
              100% {
                  transform: translate(var(--end-x), var(--end-y));
                  opacity: 0;
              }
          }

         #imageSizeDiv{
        position: relative;
        width: 100%;
        text-align: center;
        margin-bottom: 20px;
      }

      #imageSize {
        display: inline-block;
        /* margin: 15px 0; */
        /* padding: 10px 20px; */
        background: transparent;
        border: none;
        border-radius: 8px;
        color: #fcfcfc;
        font-size: 1.1rem;
        font-weight: 600;
        font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
          "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11);
      }
      </style>
</head>
<body>
    <div class="starfield" id="starfield"></div>
    <div class="container">
        <h1>Encode Audio into Image</h1>
  
        <button id="startRecordingButton">Start Recording</button>
        <button id="stopRecordingButton" disabled>Stop Recording</button>
  
         <div id="imageSizeDiv">
          <label id="imageSize"
            >Select Audio file to see the Required Pixels</label
          >
        </div>
  
        <div class="file-input-wrapper">
          <input type="file" id="imageInput" accept="image/*" />
          <label for="imageInput" class="file-input-label">Select Image</label>
        </div>
        <button class="btn" id="encodeAudioButton" disabled>
          <strong>Encode</strong>
          <div id="container-stars">
            <div id="stars"></div>
          </div>
  
          <div id="glow">
            <div class="circle"></div>
            <div class="circle"></div>
          </div>
        </button>
        <!-- <button id="encodeAudioButton" disabled>Encode Image</button> -->
        <button id="downloadButton" disabled>Download</button>
        <button id="shareButton" disabled>Share</button>
  
        <canvas id="canvas" style="display: none"></canvas>
      </div>
 
      <script>
        const starfield = document.getElementById('starfield');
       const starCount = 500;
       const movementRange = 200;
       for (let i = 0; i < starCount; i++) {
           const star = document.createElement('div');
           star.className = 'star';
           const x = Math.random() * 100;
           const y = Math.random() * 100;
           const size = 0.5 + Math.random() * 3.3;
           
           const opacity = 0.3 + Math.random() * 1;
           
           const angle = Math.random() * Math.PI * 2;
           const distance = 10 + Math.random() * movementRange;
           const startX = Math.cos(angle) * distance + 'px';
           const startY = Math.sin(angle) * distance + 'px';
           const endX = -Math.cos(angle) * distance + 'px';
           const endY = -Math.sin(angle) * distance + 'px';
       
           const duration = 10 + Math.random() * 10;
           const delay = Math.random() * -duration;
           star.style.left = `${x}%`;
           star.style.top = `${y}%`;
           star.style.width = `${size}px`;
           star.style.height = `${size}px`;
           star.style.opacity = opacity;
           star.style.setProperty('--start-x', startX);
           star.style.setProperty('--start-y', startY);
           star.style.setProperty('--end-x', endX);
           star.style.setProperty('--end-y', endY);
           star.style.setProperty('--opacity', opacity);
           star.style.animationDuration = `${duration}s`;
           star.style.animationDelay = `${delay}s`;
           // star.style.boxShadow = `1px 1px 1px 1px white`;
           
           starfield.appendChild(star);
       }

   
     let audioChunks = [];
     let recorder;
     let audioData;
     let encodedImageBlob;
     let requiredPixels = 0;

     document.getElementById("startRecordingButton").onclick = () => {
       navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
         recorder = new MediaRecorder(stream);
         audioChunks = [];
         recorder.ondataavailable = (e) => audioChunks.push(e.data);

         recorder.onstop = async () => {
           const audioBlob = new Blob(audioChunks, { type: "audio/wav" });

           const reader = new FileReader();
           reader.readAsArrayBuffer(audioBlob);
           reader.onloadend = () => {
             audioData = new Uint8Array(reader.result);
             requiredPixels = audioData.length * 8; // Each byte needs 8 pixels (LSB in R, G, or B)
              calculateRequiredImageSize(audioBlob);

             //   console.log("Audio length (bytes):", audioData.length); // Debugging
             document.getElementById("encodeAudioButton").disabled = false;
           };
         };

         recorder.start();
         document.getElementById("stopRecordingButton").disabled = false;
       });
     };

     async function calculateRequiredImageSize(audioFile) {
        const audioArrayBuffer = await audioFile.arrayBuffer();
        const audioData = new Uint8Array(audioArrayBuffer);
        const audioSizeBytes = audioData.length;
        const totalBitsNeeded = 24 + audioSizeBytes * 8;
        const totalPixelsNeeded = Math.ceil(totalBitsNeeded / 3);

        const sideLength = Math.ceil(Math.sqrt(totalPixelsNeeded));

    
        document.getElementById(
          "imageSize"
        ).innerText = `Required Image Size: ${sideLength}x${sideLength}px`;
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + " bytes";
        else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + " KB";
        else return (bytes / 1048576).toFixed(1) + " MB";
      }

     document.getElementById("stopRecordingButton").onclick = () => {
       recorder.stop();
       document.getElementById("stopRecordingButton").disabled = true;
     };

     document.getElementById("encodeAudioButton").onclick = () => {
       const imageFile = document.getElementById("imageInput").files[0];
       if (!imageFile) {
         alert("Please select an image file first.");
         return;
       }

       const img = new Image();
       img.src = URL.createObjectURL(imageFile);

       img.onload = () => {
         const canvas = document.getElementById("canvas");
         canvas.width = img.width;
         canvas.height = img.height;
         const ctx = canvas.getContext("2d");
         ctx.drawImage(img, 0, 0);

         const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
         const availablePixels = img.width * img.height * 3; // 3 channels (RGB)

         if (availablePixels < requiredPixels) {
           alert(
             "The selected image does not have enough pixels to encode the audio."
           );
           return;
         }

         encodeAudioIntoImageLSB(imgData.data, audioData);
         ctx.putImageData(imgData, 0, 0);
         canvas.toBlob((blob) => {
           encodedImageBlob = blob;
           document.getElementById("downloadButton").disabled = false;
           document.getElementById("shareButton").disabled = false;
         }, "image/png");
       };
     };

     document.getElementById("downloadButton").onclick = () => {
       if (encodedImageBlob) {
         const downloadLink = document.createElement("a");
         downloadLink.href = URL.createObjectURL(encodedImageBlob);
         downloadLink.download = "encoded_image.png";
         downloadLink.click();
       } else {
         alert("No encoded image available. Please encode an image first.");
       }
     };

     document.getElementById("shareButton").onclick = () => {
       if (encodedImageBlob) {
         const file = new File([encodedImageBlob], "encoded_image.png", {
           type: "image/png",
         });
         if (navigator.canShare && navigator.canShare({ files: [file] })) {
           navigator
             .share({
               files: [file],
               title: "Encoded Audio Image",
               text: "Check out this image with encoded audio data!",
             })
             .then(() => {
               console.log("Image shared successfully");
             })
             .catch((error) => {
               console.log("Error sharing: ", error);
             });
         } else {
           alert("Sharing is not supported on this device or browser.");
         }
       } else {
         alert("No encoded image available. Please encode an image first.");
       }
     };

     function encodeAudioIntoImageLSB(imageData, audioData) {
       for (let i = 0; i < 24; i++) {
         const bytePos = Math.floor(i / 8);
         const bitPos = i % 8;
         imageData[i] =
           (imageData[i] & 0xfe) |
           ((audioData.length >> ((2 - bytePos) * 8 + (7 - bitPos))) & 1);
       }

       let audioIndex = 0;
       let bitIndex = 0;
       for (
         let i = 32;
         audioIndex < audioData.length && i < imageData.length;
         i++
       ) {
         const bit = (audioData[audioIndex] >> (7 - bitIndex)) & 1;
         imageData[i] = (imageData[i] & 0xfe) | bit;

         bitIndex++;
         if (bitIndex === 8) {
           audioIndex++;
           bitIndex = 0;
         }
       }
     }

    
   </script>
</body>
</html>
